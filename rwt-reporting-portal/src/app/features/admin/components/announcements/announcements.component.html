<div class="announcements-container">
  <main class="page-main">
    <div class="page-content">
      <!-- Breadcrumb navigation -->
      <ibm-breadcrumb [noTrailingSlash]="true" class="page-breadcrumb">
        <ibm-breadcrumb-item [href]="'/dashboard'">Dashboard</ibm-breadcrumb-item>
        <ibm-breadcrumb-item>Announcements</ibm-breadcrumb-item>
      </ibm-breadcrumb>

      <!-- Page title section -->
      <div class="page-title-section">
        <div class="page-title-left">
          <h1 class="page-title">Announcements</h1>
          <p class="page-description">Create and manage announcements for the dashboard</p>
        </div>
      </div>

      <div class="toolbar">
        <div class="toolbar-left">
          <ibm-search
            [value]="searchQuery"
            (valueChange)="onSearchChange($event)"
            placeholder="Search announcements..."
            [size]="'sm'">
          </ibm-search>
          <ibm-toggle
            [checked]="showDeleted"
            (checkedChange)="toggleShowDeleted()"
            size="sm"
            [onText]="''"
            [offText]="''"
            label="Show deleted">
          </ibm-toggle>
        </div>
        <div class="toolbar-right">
          <button cdsButton="primary" size="sm" (click)="openCreateModal()">
            <svg cdsIcon="add" size="16" class="cds--btn__icon"></svg>
            New Announcement
          </button>
        </div>
      </div>

      <div class="table-container">
        <ibm-table-container>
          <ibm-table
            [model]="isLoading ? skeletonModel : tableModel"
            [skeleton]="isLoading"
            [showSelectionColumn]="false"
            [striped]="false">
          </ibm-table>
        </ibm-table-container>

        <div *ngIf="!isLoading && filteredAnnouncements.length === 0" class="no-results">
          <p *ngIf="searchQuery">No announcements found matching "{{ searchQuery }}"</p>
          <p *ngIf="!searchQuery && !showDeleted">No announcements yet. Create your first one!</p>
          <p *ngIf="!searchQuery && showDeleted">No deleted announcements found.</p>
        </div>

        
        <div *ngIf="totalItems > 0" class="pagination-wrapper">
          <ibm-pagination
            [model]="{ currentPage: currentPage, pageLength: pageSize, totalDataLength: totalItems }"
            (selectPage)="onPageChange($event)">
          </ibm-pagination>
        </div>
      </div>
    </div>
  </main>
</div>

<ng-template #statusTemplate let-data="data">
  <ibm-tag [type]="getStatusType(data)">
    {{ getStatusLabel(data) }}
  </ibm-tag>
</ng-template>

<ng-template #featuredTemplate let-data="data">
  <button
    class="featured-btn"
    [class.is-featured]="data.isFeatured"
    (click)="toggleFeatured(data)"
    [disabled]="data.isDeleted"
    [title]="data.isFeatured ? 'Remove from featured' : 'Set as featured'">
    <svg *ngIf="data.isFeatured" cdsIcon="star--filled" size="16"></svg>
    <svg *ngIf="!data.isFeatured" cdsIcon="star" size="16"></svg>
  </button>
</ng-template>

<ng-template #actionsTemplate let-data="data">
  <div class="action-buttons">
    <ng-container *ngIf="!data.isDeleted">
      <button
        cdsButton="ghost"
        size="sm"
        (click)="openEditModal(data)"
        title="Edit">
        <svg cdsIcon="edit" size="16"></svg>
      </button>
      <button
        *ngIf="!data.isPublished"
        cdsButton="ghost"
        size="sm"
        (click)="publishAnnouncement(data)"
        title="Publish">
        <svg cdsIcon="checkmark" size="16"></svg>
      </button>
      <button
        *ngIf="data.isPublished"
        cdsButton="ghost"
        size="sm"
        (click)="unpublishAnnouncement(data)"
        title="Unpublish">
        <svg cdsIcon="close" size="16"></svg>
      </button>
      <button
        cdsButton="danger--ghost"
        size="sm"
        (click)="deleteAnnouncement(data)"
        title="Delete">
        <svg cdsIcon="trash-can" size="16"></svg>
      </button>
    </ng-container>
    <ng-container *ngIf="data.isDeleted">
      <button
        cdsButton="ghost"
        size="sm"
        (click)="restoreAnnouncement(data)"
        title="Restore">
        <svg cdsIcon="renew" size="16"></svg>
      </button>
    </ng-container>
  </div>
</ng-template>

<cds-modal
  [open]="showModal"
  (close)="closeModal()"
  size="lg">
  <cds-modal-header [showCloseButton]="false">
    <h3 cdsModalHeaderHeading>{{ isEditing ? 'Edit Announcement' : 'New Announcement' }}</h3>
  </cds-modal-header>

  <section cdsModalContent>
    <div class="form-grid">
      
      <div class="form-field full-width">
        <label class="form-label">Title *</label>
        <input
          ibmText
          [(ngModel)]="formData.title"
          placeholder="Enter announcement title"
          [size]="'md'">
      </div>

      
      <div class="form-field">
        <label class="form-label">Category</label>
        <select class="form-select" [(ngModel)]="formData.subtitle">
          <option value="">Select a category</option>
          <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
        </select>
      </div>

      
      <div class="form-field">
        <label class="form-label">Author Name</label>
        <input
          ibmText
          [(ngModel)]="formData.authorName"
          placeholder="e.g., IT Operations, Product Team"
          [size]="'md'">
      </div>

      
      <div class="form-field">
        <label class="form-label">Image</label>
        <select class="form-select" [(ngModel)]="formData.imagePath">
          <option *ngFor="let img of images" [value]="img.path">{{ img.label }}</option>
        </select>
      </div>

      
      <div class="form-field">
        <label class="form-label">Read Time (minutes)</label>
        <input
          ibmText
          type="number"
          [(ngModel)]="formData.readTimeMinutes"
          [min]="1"
          [max]="60"
          [size]="'md'">
      </div>

      
      <div class="form-field full-width">
        <label class="form-label">Content</label>
        <textarea
          class="content-textarea"
          [(ngModel)]="formData.content"
          placeholder="Enter announcement content (Markdown supported)"
          rows="8">
        </textarea>
      </div>

      
      <div class="form-field toggle-group">
        <label class="toggle-label">
          <input type="checkbox" [(ngModel)]="formData.isFeatured">
          <span>Featured</span>
        </label>
        <p class="form-helper">Featured announcements appear prominently on the dashboard</p>
      </div>

      <div class="form-field toggle-group">
        <label class="toggle-label">
          <input type="checkbox" [(ngModel)]="formData.isPublished">
          <span>Publish immediately</span>
        </label>
        <p class="form-helper">If unchecked, the announcement will be saved as a draft</p>
      </div>
    </div>
  </section>

  <cds-modal-footer>
    <button cdsButton="secondary" (click)="closeModal()">
      Cancel
    </button>
    <button
      cdsButton="primary"
      (click)="saveAnnouncement()"
      [disabled]="isSaving || !formData.title.trim()">
      {{ isSaving ? 'Saving...' : (isEditing ? 'Update' : 'Create') }}
    </button>
  </cds-modal-footer>
</cds-modal>

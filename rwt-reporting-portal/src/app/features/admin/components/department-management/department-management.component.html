<div class="department-management-container">
  <header class="page-header">
    <div class="header-content">
      <div class="header-left">
        <h1>Manage Departments</h1>
        <p class="header-subtitle">Organizational groups for report access control</p>
      </div>
      <div class="header-actions">
        <button cdsButton="ghost" size="sm" (click)="backToContent()">
          <svg cdsIcon="arrow--left" size="16" class="cds--btn__icon"></svg>
          Back to Content
        </button>
      </div>
    </div>
  </header>

  <main class="page-main">
    <div class="page-content">
      <div class="toolbar">
        <div class="toolbar-left">
          <ibm-search
            [value]="searchQuery"
            (valueChange)="onSearchChange($event)"
            placeholder="Search departments..."
            [size]="'sm'">
          </ibm-search>
          <ibm-toggle
            [checked]="showInactive"
            (checkedChange)="toggleShowInactive()"
            size="sm"
            [onText]="''"
            [offText]="''"
            label="Show inactive">
          </ibm-toggle>
        </div>
        <div class="toolbar-right">
          <button cdsButton="primary" size="sm" (click)="openCreateModal()">
            <svg cdsIcon="add" size="16" class="cds--btn__icon"></svg>
            Create Department
          </button>
        </div>
      </div>

      <div class="table-container">
        <ibm-table-container>
          <ibm-table
            [model]="isLoading ? skeletonModel : tableModel"
            [skeleton]="isLoading"
            [size]="'sm'"
            [showSelectionColumn]="false"
            [sortable]="true"
            [striped]="false">
          </ibm-table>
        </ibm-table-container>

        <div *ngIf="!isLoading && filteredDepartments.length === 0" class="empty-state">
          <svg cdsIcon="group" size="32"></svg>
          <p>No departments found</p>
        </div>
      </div>

      <ibm-pagination
        *ngIf="paginationModel.totalDataLength > 0"
        [model]="paginationModel"
        [itemsPerPageOptions]="itemsPerPageOptions"
        (selectPage)="onPageChange($event)"
        (pageLength)="onPageSizeChange($any($event))">
      </ibm-pagination>
    </div>
  </main>
</div>

<ng-template #statusTemplate let-data="data">
  <ibm-tag [type]="data.isActive ? 'green' : 'red'" size="sm">
    {{ data.isActive ? 'Active' : 'Inactive' }}
  </ibm-tag>
</ng-template>

<ng-template #actionsTemplate let-data="data">
  <div class="actions-cell">
    <button
      cdsButton="ghost"
      size="sm"
      (click)="openEditModal(data); $event.stopPropagation()"
      title="Edit department">
      <svg cdsIcon="edit" size="16"></svg>
    </button>
    <button
      *ngIf="data.isActive"
      cdsButton="ghost"
      size="sm"
      (click)="deleteDepartment(data); $event.stopPropagation()"
      title="Delete department">
      <svg cdsIcon="trash-can" size="16"></svg>
    </button>
    <button
      *ngIf="!data.isActive"
      cdsButton="ghost"
      size="sm"
      (click)="restoreDepartment(data); $event.stopPropagation()"
      title="Restore department">
      <svg cdsIcon="renew" size="16"></svg>
    </button>
  </div>
</ng-template>

<cds-modal
  [open]="showModal"
  (close)="closeModal()"
  size="md">
  <cds-modal-header [showCloseButton]="false">
    <h3 cdsModalHeaderHeading>{{ isEditing ? 'Edit Department' : 'Create Department' }}</h3>
  </cds-modal-header>

  <section cdsModalContent>
    <div class="modal-form">
      <div class="form-field">
        <label class="form-label required-field">Department Name *</label>
        <input
          ibmText
          [(ngModel)]="formData.name"
          placeholder="Enter department name"
          [size]="'md'">
      </div>

      <div class="form-field">
        <label class="form-label">Description</label>
        <textarea
          class="form-textarea"
          [(ngModel)]="formData.description"
          placeholder="Enter department description"
          rows="3">
        </textarea>
      </div>
    </div>
  </section>

  <cds-modal-footer>
    <button cdsButton="secondary" (click)="closeModal()">
      Cancel
    </button>
    <button
      cdsButton="primary"
      (click)="saveDepartment()"
      [disabled]="isSaving">
      {{ isSaving ? 'Saving...' : (isEditing ? 'Save Changes' : 'Create Department') }}
    </button>
  </cds-modal-footer>
</cds-modal>
